<h2>Convidar novo usuário</h2>

<div class="required_info"></div><br />

<div class="authform" style="float:left; width:50%;">
  <%= form_for resource, :as => resource_name, :url => invitation_path(resource_name), :html => {:method => :post} do |f| %>
  <%= devise_error_messages! %>
  <div class="form-group">
    <% resource.class.invite_key_fields.each do |field| -%>
      <p><%= f.label field, class: 'required' %>
        <%= f.text_field field, :autofocus => true, class: 'form-control' %></p>
    <% end -%>
  </div>
  <div class="form-group">
    <% unless current_user.admin? %>
      <%= f.hidden_field :role, value: $roles_allowed[0] %>
    <% else %>
      <% if @role %>
        <%= f.hidden_field :role, value: @role %>
      <% else %>
        <%= f.label "Escolha o tipo de usuário", class: 'required' %>
        <%= f.select(:role, $roles_allowed, {:include_blank => "Selecione", :selected => nil, required: true}, {:class => "form-control"})%>
      <% end %>
    <% end %>
  </div>
  <% if current_user.admin? %>
    <% if @sei %>
      <%= f.hidden_field :sei, value: @sei %>
      <% elsif @role == 'company_admin' || @role == 'company_user' %>
        <div class="form-group" id='sei_group'>
          <%= f.label "Escolha a empresa (sei)" %>
          <%= f.select(:sei, $companies, {:include_blank => "Selecione", :selected => nil}, {:class => "form-control"})%>
        </div>
      <% else %>
        <div class="form-group" id='city_group' style="display: none">
          <%= f.label "Escolha a Cidade" %>
          <%= f.select(:city_id, $cities, {:include_blank => "Selecione", :selected => nil}, {:class => "form-control"})%>
        </div>
        <div class="form-group" id='sei_group' style="display: none">
          <%= f.label "Escolha a empresa (sei)" %>
          <%= f.select(:sei, $companies, {:include_blank => "Selecione", :selected => nil}, {:class => "form-control"})%>
        </div>
        <script>
          $('#user_role').change(e => {
            if (e.target.value == 'city_admin') {
              $('#sei_group').hide(0);
              $('#city_group').show(0);
            } else if (e.target.value == 'company_admin') {
              $('#sei_group').show(0);
              $('#city_group').hide(0);
            } else {
              $('#sei_group').hide(0);
              $('#city_group').hide(0);
            }
          });
        </script>
      <% end %>
    <% end %>
    <% if current_user.city_admin? %>
      <div class="form-group">
        <%= f.label "Escolha a UBS" %>
        <%= f.select(:cnes, $unities_allowed, {:include_blank => "Selecione", :selected => nil}, {:class => "form-control"})%>
        <%= f.hidden_field :city_id, :value => $current_user_city %>
      </div>
    <% end %>

    <% if current_user.company_admin? %>
      <%= f.hidden_field :sei, :value => $current_user_sei %>
    <% end %>

    <% if current_user.ubs_admin? %>
      <%= f.hidden_field :cnes, :value => $current_user_cnes %>
    <% end %>

    <p><%= f.submit "Enviar convite", :class => 'btn btn-primary' %></p>
  <% end %>
</div>
