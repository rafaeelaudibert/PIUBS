<%= content_for :body_title do%>
<div class="left">
  <h4 class="display-5">FAQ</h4>
</div>
<div class="right create-new">
  <%= link_to 'Cadastrar nova questão', new_answer_path(source: 'controversy'), class: 'btn btn-primary btn-lg' %>
</div>
<%end%>
</hr>

<%= form_for_filterrific @filterrific do |f| %>
  <div class="left form-group" style="width:50%;">
    <%= f.label :filterrific_with_category, 'Filtro de Categorias'%>
    <select name="filterrific[with_category]" id="filterrific_with_category" class="form-control">
      <option value>Todas categorias</option>
      <%= inside_layout "categories/category_select",
                        {categ: Category.where(source: :from_controversy),
                         selected: params[:filterrific] &&
                                   params[:filterrific][:with_category].to_i != 0 &&
                                   Category.find(params[:filterrific][:with_category].to_i)} do %>
        <%= yield %>
      <% end %>
    </select>
    <%= (link_to 'Desfazer filtros',
                 reset_filterrific_url,
                 class: 'btn btn-danger',
                 style: 'margin-top: 0.375em') if params[:filterrific] %>
  </div>
  <div class="right input-group" style="width: 40%; margin: 15px auto !important">
    <input name="filterrific[search_query_faq_controversy]" id="filterrific_search_query_faq_controversy" class="form-control mr-sm-2" type="search" aria-label="Search">
    <label>
      <i class="fa fa-search"></i>
      &nbsp;Pesquise no FAQ
    </label>
    <button class="btn btn-primary my-2 my-sm-0" type="submit">Pesquisar</button>
  </div>
  <%= f.submit "Mostrar",
               id: 'mostrar-filter',
               class: 'btn btn-link invisible right' %>

  <%# add an automated spinner to your form when the list is refreshed %>
  <%= render_filterrific_spinner %>
<% end %>

<hr class="under-header" style="margin-top: <%= params[:filterrific] ? '8em' : '5em'%>"/>

<div id="filterrific_results">
  <% if @answers.length > 0 %>
  <div id="accordion" class="accordion-faq">
    <div id="my-answers">
      <%= render @answers %>
    </div>
  </div>

  <div id="infinite-scrolling">
    <%= will_paginate @answers %>
  </div>
  <% else %>
  <h3>
    Não há perguntas no FAQ
  </h3>
  <% end %>
</div>
<hr/>

<script>
$('document').ready(function () {

  $('#filterrific_with_category').on('change', () => {
    $('#mostrar-filter').click();
  })

  $('#filterrific_search_query_faq').on('focusout', function () {
    changeState($(this));
  });

  function changeState(form) {
    if (form.val().length > 0) {
      form.addClass('has-value');
    } else {
      form.removeClass('has-value');
    }
  }

});
</script>
